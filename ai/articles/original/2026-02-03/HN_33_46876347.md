---
title: "When rust â‰  performance. a lesson in developer experience"
url: "https://suriya.cc/tech/performance/oxen-add/"
source: "Hacker News"
date: "2026-02-03"
score: "33"
author: "suriya-ganesh"
---

# When rust â‰  performance. a lesson in developer experience

**æ¥æº**: [Hacker News](https://news.ycombinator.com/item?id=46876347) | **è¯„åˆ†**: 33 | **ä½œè€…**: @suriya-ganesh

## åŸæ–‡å†…å®¹

Title: when rust â‰  performance. a lesson in devex.

URL Source: http://suriya.cc/tech/performance/oxen-add/

Published Time: 2026-02-02T00:00:00Z

Markdown Content:
when rust â‰  performance. a lesson in devex. | Suriya Ganesh - Technical Writing
===============
[â†](javascript:history.back())[home](http://suriya.cc/)[tech](http://suriya.cc/tech)[now](http://suriya.cc/now)[â†’](javascript:history.forward())

*   [food](http://suriya.cc/food/) 

    *   [my mother's recipe](http://suriya.cc/food/vani/)
    *   [coffee](http://suriya.cc/food/coffee/)

*   [travelling](http://suriya.cc/travel/) 

    *   [madurai](http://suriya.cc/travel/madurai/)
    *   [pittsburgh](http://suriya.cc/travel/pittsburgh/)
    *   [atlanta](http://suriya.cc/travel/atlanta/)
    *   [bangalore aka bengaluru](http://suriya.cc/travel/bangalore/)

*   [poems](http://suriya.cc/poems/) 

    *   [do not go gentle into that good night](http://suriya.cc/poems/dont-gentle/)
    *   [if](http://suriya.cc/poems/if/)
    *   [still i rise](http://suriya.cc/poems/still-i-rise/)
    *   [à®ªà¯à®¤à®¿à®¯ à®†à®¤à¯à®¤à®¿à®šà¯‚à®Ÿà®¿](http://suriya.cc/poems/puthiya/)
    *   [à®ªà¯‚à®¤à¯à®¤à®¤à¯ à®®à®¾à®©à¯à®Ÿà®®à¯](http://suriya.cc/poems/indrilai/)
    *   [à®µà®°à®™à¯ à®•à¯‡à®Ÿà¯à®Ÿà®²à¯ - à®ªà®¾à®°à®¤à®¿](http://suriya.cc/poems/thedi/)

*   [general](http://suriya.cc/general/) 

    *   [successful cold emailing](http://suriya.cc/general/cold_email/)
    *   [why accelerate?](http://suriya.cc/general/accelerate/)
    *   [software engineering agents work. but only if you do](http://suriya.cc/general/gpt-code/)
    *   [sweating the details](http://suriya.cc/general/never-complete/)
    *   [ai media editor](http://suriya.cc/general/ai-media-editor/)
    *   [newsletters and blogs that are interesting](http://suriya.cc/general/awesome-newsletters/)
    *   [awesome incubators/collectives for startups](http://suriya.cc/general/awesome-incubators/)
    *   [product ideas](http://suriya.cc/general/product-ideas/)

*   [essays](http://suriya.cc/essays/) 

    *   [what are your priorities?](http://suriya.cc/essays/priority/)
    *   [the future of media](http://suriya.cc/essays/media_future/)
    *   [life has no answers, but inifinite questions](http://suriya.cc/essays/gowsik/)
    *   [shiptalk](http://suriya.cc/essays/07_shiptalk/)
    *   [product building and fundamentals](http://suriya.cc/essays/product/)
    *   [why i build.](http://suriya.cc/essays/why-i-build/)
    *   [writing](http://suriya.cc/essays/effective_writing/)
    *   [organizational wisdom](http://suriya.cc/essays/organizational/)
    *   [leaky abstractions, or how we understand the world](http://suriya.cc/essays/leaky_abstractions/)
    *   [inertia](http://suriya.cc/essays/inertia/)
    *   [postmortem from building an ai speech coach](http://suriya.cc/essays/speaksharp/)
    *   [solutions vs feelings](http://suriya.cc/essays/solution_v_feelings/)
    *   [tell us about the time you most successfully hacked some (non-computer) system to your advantage](http://suriya.cc/essays/hack/)
    *   [why accelerate?](http://suriya.cc/essays/01_exceptional/)
    *   [right around the corner, a story of million possibilities](http://suriya.cc/essays/03_right_around_the_corner/)
    *   [working at a startup](http://suriya.cc/essays/04_startup_work/)
    *   [the future and the story](http://suriya.cc/essays/06_the_future_and_the_story/)
    *   [surplus intellectual capacity](http://suriya.cc/essays/05_surplus_capacity/)
    *   [arm](http://suriya.cc/essays/arm/)
    *   [the missing innovation](http://suriya.cc/essays/02_missing_innovation/)

*   [books](http://suriya.cc/books/) 

    *   [poor richard's almanack](http://suriya.cc/books/poor_richard/)
    *   [hail mary](http://suriya.cc/books/hail_mary/)
    *   [how big things get done](http://suriya.cc/books/how_big_things_get_done/)
    *   [machines of loving grace](http://suriya.cc/books/machines_of_loving_grace/)
    *   [how and why i taught my toddler to read](http://suriya.cc/books/why_I_taught_my_kid/)
    *   [poor charlie's almanack (2005)](http://suriya.cc/books/poor_charlie/)
    *   [the metamorphosis - franz kafka](http://suriya.cc/books/metamorphosis/)
    *   [the immortal life of henrietta lacks](http://suriya.cc/books/HeLa/)
    *   [source code](http://suriya.cc/books/source_code/)
    *   [almond](http://suriya.cc/books/almond/)
    *   [the practice](http://suriya.cc/books/the_practice/)
    *   [dune](http://suriya.cc/books/dune/)
    *   [dune - the messiah](http://suriya.cc/books/dune_messiah/)
    *   [allegory of the cave](http://suriya.cc/books/allegory_of_the_cave/)
    *   [data privacy](http://suriya.cc/books/data_privacy/)
    *   [the little prince - antoine de saint-exupÃ©ry](http://suriya.cc/books/little_prince/)
    *   [to cut a long story short - jeffrey archer](http://suriya.cc/books/long_story_short/)
    *   [a graduate course in applied cryptography](http://suriya.cc/books/applied_crypto/)
    *   [programmers introduction to mathematics](http://suriya.cc/books/pim/)
    *   [my inventions - nikola tesla](http://suriya.cc/books/my_inventions/)
    *   [straight a](http://suriya.cc/books/straight_a/)
    *   [badminton handbook](http://suriya.cc/books/badminton/)
    *   [when breath becomes air](http://suriya.cc/books/air/)
    *   [trust me i'm lying](http://suriya.cc/books/trust_me/)
    *   [build - tony fadell](http://suriya.cc/books/build/)
    *   [make something wonderful - steve jobs](http://suriya.cc/books/wonderful/)
    *   [the psychology of money](http://suriya.cc/books/psych_money/)
    *   [where wizards stay up late](http://suriya.cc/books/wizard/)
    *   [](http://suriya.cc/books/scattered_minds/)

*   [journal](http://suriya.cc/til/) 

    *   [karpathy micrograd](http://suriya.cc/til/08-02-2025/)

*   [technology](http://suriya.cc/tech/) 

    *   [algorithms](http://suriya.cc/tech/algos/) 

        *   [algorithms](http://suriya.cc/tech/algos/problems/) 

            *   [cp4](http://suriya.cc/tech/algos/problems/cp4/) 

                *   [chapter 1 exercises](http://suriya.cc/tech/algos/problems/cp4/00_ch1_ex/)
                *   [](http://suriya.cc/tech/algos/problems/cp4/flash_cards/input/00_ch1/)

            *   [leetcode](http://suriya.cc/tech/algos/problems/leetcode/) 

                *   [42. trapping rain water](http://suriya.cc/tech/algos/problems/leetcode/42_trapping_rain/)
                *   [min in rotated array](http://suriya.cc/tech/algos/problems/leetcode/154_min_in_rotated_arr/)
                *   [longest valid parentheses](http://suriya.cc/tech/algos/problems/leetcode/32_longest_parentheses/)

        *   [cuda](http://suriya.cc/tech/algos/cuda/) 

            *   [1d convolution](http://suriya.cc/tech/algos/cuda/06_1d_convolution/)
            *   [color inversion](http://suriya.cc/tech/algos/cuda/04_color_inversion/)
            *   [count 2d array element](http://suriya.cc/tech/algos/cuda/14_count_2d_array/)
            *   [count array element](http://suriya.cc/tech/algos/cuda/13_count_array/)
            *   [leaky relu](http://suriya.cc/tech/algos/cuda/09_leaky_relu/)
            *   [matrix addition](http://suriya.cc/tech/algos/cuda/05_matrix_addition/)
            *   [matrix copy](http://suriya.cc/tech/algos/cuda/11_matrix_copy/)
            *   [matrix multiply](http://suriya.cc/tech/algos/cuda/02_matrix_multipy/)
            *   [matrix transpose](http://suriya.cc/tech/algos/cuda/03_matrix_transpose/)
            *   [rainbow table](http://suriya.cc/tech/algos/cuda/10_rainbow_table/)
            *   [relu](http://suriya.cc/tech/algos/cuda/08_ReLu/)
            *   [reverse array](http://suriya.cc/tech/algos/cuda/07_reverse_array/)
            *   [silu](http://suriya.cc/tech/algos/cuda/15_sigmoid_linear_unit/)
            *   [simple inference](http://suriya.cc/tech/algos/cuda/12_simple_inference/)
            *   [swilu](http://suriya.cc/tech/algos/cuda/16_swish_gated_linear_unit/)
            *   [vector addition](http://suriya.cc/tech/algos/cuda/01_vector_addition/)

        *   [distributed systems](http://suriya.cc/tech/algos/dist_systems/) 

            *   [gossip glomers](http://suriya.cc/tech/algos/dist_systems/gg/)

        *   [prime number library for rust](http://suriya.cc/tech/algos/prime/)
        *   [bloom filter](http://suriya.cc/tech/algos/bloom_filter/)
        *   [todo](http://suriya.cc/tech/algos/1_todo/)
        *   [](http://suriya.cc/tech/algos/README/)

    *   [machine learning](http://suriya.cc/tech/ML/) 

        *   [makemore](http://suriya.cc/tech/ML/zerotohero/makemore/)
        *   [practical deep learning](http://suriya.cc/tech/ML/practical_deep_learning/)
        *   [photogrammetry/videogrammetry or the dark art of capturing 2d and generating 3d models](http://suriya.cc/tech/ML/photogrammetry/)
        *   [ml journal](http://suriya.cc/tech/ML/ML_diary/)
        *   [word embedding models](http://suriya.cc/tech/ML/word2vec/)
        *   [streaming diarizer](http://suriya.cc/tech/ML/streaming_diarizer/)
        *   [llm code generation notes](http://suriya.cc/tech/ML/code_llm/)
        *   [federated learning](http://suriya.cc/tech/ML/federated_learning/)
        *   [different types of graphs i come across](http://suriya.cc/tech/ML/plots/)
        *   [pandas fight](http://suriya.cc/tech/ML/pandas/)
        *   [graphs and llms](http://suriya.cc/tech/ML/graph_llm/)
        *   [research papers](http://suriya.cc/tech/ML/papers/)
        *   [ml guardrails](http://suriya.cc/tech/ML/llm_guardrails/)
        *   [research ideas](http://suriya.cc/tech/ML/Research_ideas/)
        *   [prompt engineering](http://suriya.cc/tech/ML/prompt_engineering/)
        *   [purple llama](http://suriya.cc/tech/ML/purple_llama/)
        *   [membership inference attack](http://suriya.cc/tech/ML/MIA/)
        *   [intro to llm](http://suriya.cc/tech/ML/Intro_to_llm/)
        *   [](http://suriya.cc/tech/ML/broadcasting_rules/)
        *   [](http://suriya.cc/tech/ML/micrograd/)

    *   [privacy](http://suriya.cc/tech/privacy/) 

        *   [right to be forgotten](http://suriya.cc/tech/privacy/right_to_forget/)
        *   [privacy problems and attacks in machine learning](http://suriya.cc/tech/privacy/privacy_ml/)
        *   [cmu square](http://suriya.cc/tech/privacy/cmu_square/)
        *   [ai governance and threat modelling](http://suriya.cc/tech/privacy/ml_governance/)
        *   [why privacy?](http://suriya.cc/tech/privacy/why_privacy/)
        *   [browser privacy test](http://suriya.cc/tech/privacy/browser_privacy/)
        *   [privacy articles](http://suriya.cc/tech/privacy/articles/)
        *   [cicumventing ad block](http://suriya.cc/tech/privacy/gtm/)
        *   [](http://suriya.cc/tech/privacy/privacy_law/)

    *   [a bug's life](http://suriya.cc/tech/bugs/) 

        *   [gccissues](http://suriya.cc/tech/bugs/gcc/)
        *   [a backend engineer writes frontend](http://suriya.cc/tech/bugs/frontend/)
        *   [wav file shenanigans](http://suriya.cc/tech/bugs/wav_file/)
        *   [fixing chrome extension issues](http://suriya.cc/tech/bugs/browser_extension/)

    *   [cloud](http://suriya.cc/tech/cloud/) 

        *   [unix](http://suriya.cc/tech/cloud/unix/)
        *   [vim](http://suriya.cc/tech/cloud/vi/)
        *   [my stack](http://suriya.cc/tech/cloud/my_stack/)
        *   [batch processing llm inference](http://suriya.cc/tech/cloud/batch_processing_llm/)
        *   [aws](http://suriya.cc/tech/cloud/aws/)
        *   [kafka](http://suriya.cc/tech/cloud/kafka/)
        *   [aws ses](http://suriya.cc/tech/cloud/aws_ses/)

    *   [performance work](http://suriya.cc/tech/performance/) 

        *   [when rust â‰  performance. a lesson in devex.](http://suriya.cc/tech/performance/oxen-add/)

    *   [practice](http://suriya.cc/tech/practice/) 

        *   [erlang and its shenanigans](http://suriya.cc/tech/practice/erlang/) 

            *   [functional programming.](http://suriya.cc/tech/practice/erlang/functional/)
            *   [phoenix](http://suriya.cc/tech/practice/erlang/phoenix/)
            *   [elixir](http://suriya.cc/tech/practice/erlang/elixir/)

        *   [learning javascript](http://suriya.cc/tech/practice/js/) 

            *   [javascript for impatient programmers](http://suriya.cc/tech/practice/js/js_for_impatient/)
            *   [](http://suriya.cc/tech/practice/js/README/)

        *   [learning flutter](http://suriya.cc/tech/practice/flutter/) 

            *   [flutter gimmicks](http://suriya.cc/tech/practice/flutter/flutter_gimmicks/)
            *   [](http://suriya.cc/tech/practice/flutter/README/)
            *   [dart by example](http://suriya.cc/tech/practice/flutter/dart_basics/)

        *   [learning golang](http://suriya.cc/tech/practice/golang/) 

            *   [effective go](http://suriya.cc/tech/practice/golang/Effective_go/) 

                *   [effective go practice](http://suriya.cc/tech/practice/golang/Effective_go/01_intro/)

            *   [go tour](http://suriya.cc/tech/practice/golang/Go_tour/) 

                *   [learning golang 01 - basics](http://suriya.cc/tech/practice/golang/Go_tour/01_Intro/)
                *   [learning golang 02 - ds and algo](http://suriya.cc/tech/practice/golang/Go_tour/02_Data_structures/)
                *   [learning golang 03 - functions](http://suriya.cc/tech/practice/golang/Go_tour/03_Functions_and_pointers/)
                *   [learning golang 04 - goroutine](http://suriya.cc/tech/practice/golang/Go_tour/04_goroutines/)

            *   [miscelaneous details about golang](http://suriya.cc/tech/practice/golang/misc/)
            *   [](http://suriya.cc/tech/practice/golang/README/)
            *   [benchmarking](http://suriya.cc/tech/practice/golang/benchmarking/)
            *   [learning golang using go by example](http://suriya.cc/tech/practice/golang/GO_BY_EXAMPLE/)

        *   [learning github actions](http://suriya.cc/tech/practice/github_actions/) 

            *   [](http://suriya.cc/tech/practice/github_actions/README/)

        *   [ostep-notes](http://suriya.cc/tech/practice/ostep/) 

            *   [ostep-1 virtualisation](http://suriya.cc/tech/practice/ostep/Virtualisation/)

        *   [learning docker](http://suriya.cc/tech/practice/docker/) 

            *   [docker in action](http://suriya.cc/tech/practice/docker/docker-in-action/)

        *   [rust](http://suriya.cc/tech/practice/rust/) 

            *   [rust `move` keyword](http://suriya.cc/tech/practice/rust/move/)
            *   [async rust](http://suriya.cc/tech/practice/rust/async-rust/)
            *   [rust benchmarking](http://suriya.cc/tech/practice/rust/benchmarking/)
            *   [rust cheatsheet](http://suriya.cc/tech/practice/rust/cheatsheet/)
            *   [](http://suriya.cc/tech/practice/rust/patterns/)

        *   [system design](http://suriya.cc/tech/practice/sys_design/)
        *   [mapreduce](http://suriya.cc/tech/practice/mapreduce/)
        *   [language design](http://suriya.cc/tech/practice/language_design/)
        *   [regex](http://suriya.cc/tech/practice/regex/)
        *   [designing data intensive applications notes](http://suriya.cc/tech/practice/ddia/)
        *   [dbms - cmu db user group](http://suriya.cc/tech/practice/DB/)

    *   [tinkering](http://suriya.cc/tech/tinkering/) 

        *   [qmd for hugo](http://suriya.cc/tech/tinkering/qmd/)
        *   [media processing in the cli](http://suriya.cc/tech/tinkering/image-processing/)
        *   [postgres](http://suriya.cc/tech/tinkering/postgres/)
        *   [server setup](http://suriya.cc/tech/tinkering/server/)
        *   [mobile dev](http://suriya.cc/tech/tinkering/mobile_dev/)
        *   [react native](http://suriya.cc/tech/tinkering/react-native/)
        *   [vscode](http://suriya.cc/tech/tinkering/vscode/)
        *   [poetry](http://suriya.cc/tech/tinkering/poetry/)
        *   [llms and unstructured data](http://suriya.cc/tech/tinkering/structure/)
        *   [zsh](http://suriya.cc/tech/tinkering/zshrc/)
        *   [library of congress information](http://suriya.cc/tech/tinkering/loc/)
        *   [terminal](http://suriya.cc/tech/tinkering/terminal/)
        *   [read the docs](http://suriya.cc/tech/tinkering/read_docs/)
        *   [shell hacks](http://suriya.cc/tech/tinkering/shell/)
        *   [git lfs](http://suriya.cc/tech/tinkering/git/)
        *   [intellij hacks](http://suriya.cc/tech/tinkering/intellij/)
        *   [web](http://suriya.cc/tech/tinkering/web/)
        *   [hugo notes](http://suriya.cc/tech/tinkering/hugo/)
        *   [pocketbase](http://suriya.cc/tech/tinkering/pocketbase/)
        *   [visualising performance](http://suriya.cc/tech/tinkering/profiler/)
        *   [django issues and quick fixes](http://suriya.cc/tech/tinkering/django/)
        *   [building an extension](http://suriya.cc/tech/tinkering/browser_extension/)
        *   [searching for a cross platform framework](http://suriya.cc/tech/tinkering/search_cross_platform/)
        *   [registering with google and other](http://suriya.cc/tech/tinkering/seo/)
        *   [installing jekyll for the first time and issues](http://suriya.cc/tech/tinkering/ruby_v_xcode/)
        *   [local tunnels with cloudflare](http://suriya.cc/tech/tinkering/local_tunnels/)
        *   [ruby hack](http://suriya.cc/tech/tinkering/ruby/)
        *   [searching for a self-hosted vpn](http://suriya.cc/tech/tinkering/vpn/)
        *   [](http://suriya.cc/tech/tinkering/flexbox/)
        *   [](http://suriya.cc/tech/tinkering/git-diff/)
        *   [custom user agent for testing](http://suriya.cc/tech/tinkering/custom_ua/)

    *   [websites that are interesting](http://suriya.cc/tech/websites/)

ğŸï¸

when rust â‰  performance. a lesson in devex.
===========================================

getting 20x speedup by removing code.

February 2, 2026 Â· 2 min read Â· [tech](http://suriya.cc/tags/tech), [performance](http://suriya.cc/tags/performance)

I love working at oxen because we strive to be the fastest data versioning tool in the market. Which is why we often do multi terabyte benchmarks on each [commands that we support](https://docs.oxen.ai/getting-started/command-line/local_development) , (add, commit, etc.)

All staged files, their location and the file hashes get stored in a [rocksdb](https://github.com/facebook/rocksdb) when `oxen add` command is used, then during `oxen commit` we create new nodes for new files/dirs and commit.

I was noting that our add times were pretty quick. ~1 minute for 1M files. But, commit was taking >50 minutes. This was interesting to me because commit is an O(n) algorithm with n = number of directories. we create n directory nodes and 1 commit node, that is all. even with a million files that is not that many directories.

As is usual for all performance work. I profiled the `commit` command with, [samply](https://github.com/mstange/samply) which is a wildly convenient tool to profile binaries and view it on a nice UI.

![Image 4: Oxen commit perf](http://suriya.cc/assets/images/oxen-commit.png)

If you notice closely, >90% of the time was being spent just getting the lock on the staging RocksDB. This was because all our parallel workers are graduating the files from staged to committed by creating the respective nodes for the directories and creating a complete view of the repository at that commit.

but because we have this data (file name, etc.) passed back and forth between different layers in the code. we were doing lots of `.clone()` and `db.open()` at different layers to fetch the same data. The interesting part for me was that, this change removed code instead of adding.

The final [PR](https://github.com/Oxen-AI/Oxen/pull/127/changes) looked like this to improve performance by 20X

![Image 5: Oxen commit perf](http://suriya.cc/assets/images/oxen-commit-diff.png)

With performance sensitive application. Often less is more and simple is better.

I often think about this [quote from Fabien](https://x.com/rygorous/status/1271296834439282690) .

![Image 6: Fabien performance quote](http://suriya.cc/assets/images/fabian-performance.png)

In this case, it was true. In good software engineering fashion, all our layers had clear separation of concerns. Which lead to repeated context retrieval for each thread / async operation leading to thread contention for the same resource. Personally this was a lesson for me on thinking about the Design and impact of the whole system even when adding a seemingly isolated feature.

As an aside it is interesting that, rocksdb is not the ideal candidate for our â€œparallel readsâ€ use case, because rocksdb is designed for parllel writes. which is why we see this unexpected overhead.

* * *

[tech](http://suriya.cc/tags/tech)[performance](http://suriya.cc/tags/performance)

[](https://github.com/subygan/ "github")

[](mailto:suriyaganesh097@gmail.com "email")

[](https://t.me/SuriyaGanesh "telegram")

[](https://x.com/subygan "twitter")

[](https://www.instagram.com/suby.gan/ "instagram")

Â© 2026 Surya Ganesh (Suriya Ganesh Ayyamperumal)

â†‘

---
*è‡ªåŠ¨é‡‡é›†äº 2026-02-03*
