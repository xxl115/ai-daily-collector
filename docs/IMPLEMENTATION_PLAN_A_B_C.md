# Implementation Plans for AI Content Processing Pipeline

本文档汇总三种实施方案（A/B/C），覆盖从快速落地到高可扩展性架构的不同需求，包含阶段性工作计划、里程碑、风险与回滚点，以及资源/成本估算，便于对比决策与落地。

## 方案 A：GitHub Actions 基线实现（最快落地、成本最低、易维护）

目标
- 在 GitHub Actions 环境中实现端到端的内容处理流水线：提取内容、生成摘要、分类、生成日报；并实现幂等、降级策略、简单监控与缓存。

架构概览
- RSS/源抓取 -> 内容提取（trafilatura 为主、Jina 作为降级） -> 摘要（Ollama/qwen） -> 分类（BAAI/bge-m3 Embedding） -> 日报生成 -> Git 提交/推送（可选 Notion 同步）
- GH Actions 资源受限，需要考虑缓存、分阶段执行、降级路径。

阶段性工作计划
- 阶段 1：建立骨架与最小可用的端到端链
  - 创建 GH Actions 工作流草案，执行基础提取、摘要、分类、日报输出。
  - 引入幂等性：对每篇文章使用唯一标识（URL + 版本）进行去重。
  - 初步降级：提取失败降级到 RSS 描述，摘要失败降级为文本截断。
- 阶段 2：缓存与稳定性增强
  - 引入依赖缓存和模型缓存，减少重复下载与加载时间。
  - 强化错误处理、重试策略（指数退避、最大重试次数）。
  - 增加简单的观察性日志和指标输出。
- 阶段 3：可观测性与鲁棒性提升
  - 引入数据血缘（来源、版本、处理时间、结果哈希）
  - 增加单元/端到端测试用例，覆盖正常与异常场景
- 阶段 4：性能与成本控制
  - 基于实际运行数据做性能调优与成本预算（文章批量、并发度、缓存命中率）

里程碑（示意）
- Milestone 1：骨架搭建并完成端到端运行（30篇以下示例）
- Milestone 2：实现幂等、降级、缓存和基础监控
- Milestone 3：达到稳定的端到端运行并通过简单测试
- Milestone 4：完成文档与回滚计划并准备上线

风险与回滚点
- 风险：GitHub Actions 超时/资源受限
  回滚：降低 MAX_ARTICLES，并启用分段执行与降级路径
- 风险：Ollama 模型加载失败/推理慢
  回滚：回退至本地摘要替代方案，缓存策略优先
- 风险：外部降级服务不可用
  回滚：提供 RSS 描述降级路线，并记录失败日志
- 风险：幂等性边界不清晰导致重复/漏处理
  回滚：使用全局去重表与版本控制，确保幂等性边界

成本与资源估算（草案）
- GitHub Actions：免费额度，按实际执行时间计费
- 模型和依赖缓存：本地/CI 缓存减少重复拉取
- 伪代码/模板：保持轻量，避免额外成本

参考链接（示例）
- GitHub Actions caching: https://docs.github.com/en/actions
- Trafilatura:  https://github.com/adbar/trafilatura
- Ollama: https://ollama.ai/
- BBAI/bge-m3: https://huggingface.co/baai/bge-m3
- Dagster Prefect 设计模式（用于后续替代）

## 方案 B：使用 Dagster/Prefect 进行端到端编排（高鲁棒性、可观测性）

目标
- 以 Dagster/Prefect 作为编排器，将提取、摘要、分类、日报生成等步骤封装为可观测、可重用的资产/任务。

架构要点
- 数据资产：文章、摘要、分类、日报等。
- 流程控制：重试、并发、资源隔离、血缘、日志与可观测性。
- 与 GH Actions 的关系：CI/CD 触发与本地/云端执行分离。

阶段性工作计划
- 阶段 1：确定任务图/资产模型、建立最小可运行的 DAG/流
- 阶段 2：实现核心资产（提取、摘要、分类、日报）与依赖关系
- 阶段 3：添加血缘、指标与监控，编写端到端测试
- 阶段 4：CI/CD 集成与回滚/降级策略

里程碑
- Milestone 1：核心资产/工作流可运行
- Milestone 2：数据血缘与观测性完备
- Milestone 3：端到端稳定性与容错完成

风险与回滚点
- 风险：学习成本与运维成本
- 回滚：先在 GH Actions 方案 A 验证稳定性，再扩展到 Dagster/Prefect。

## 方案 C：微服务化端到端流水线（长线可扩展性、灵活部署）

目标
- 将各阶段切分为独立微服务（提取、摘要、分类、日报生成、报告聚合），通过轻量队列/HTTP 接口解耦。

概要
- 服务化后可独立扩展、语言/框架可替换，便于将来迁移到 Kubernetes/云端。

阶段性工作计划
- 阶段 1：定义接口、搭建最小微服务雏形
- 阶段 2：搭建聚合器/编排控制器，处理任务分发与结果聚合
- 阶段 3：实现缓存、幂等、重试与健康检查
- 阶段 4：端到端测试与成本评估

里程碑
- Milestone 1：微服务原型就绪
- Milestone 2：聚合器就绪，端到端可跑
- Milestone 3：实现缓存与幂等，稳定运行

风险与回滚点
- 风险：运维复杂度较高、部署成本上升
- 回滚：回退到方案 A（GH Actions 基线），将微服务作为后续阶段进行迁移

附注
- 本文档仅作方案对比与落地参考，具体实施请结合实际资源与团队能力制定详细计划。
