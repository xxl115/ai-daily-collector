# Implementation Plan - Phase II (方案 B：Dagster/ Prefect 编排初步)

目的：在基线 A 稳定后，初步引入编排器（Dagster 或 Prefect），实现端到端工作流的可观测性、血缘、重试策略和更清晰的阶段化治理。仅作为初步落地，确保对现有代码的最小侵入。

## 目标与范围
- 将方案 A 的核心步骤拆分为可观测的资产/任务：提取、摘要、分类、日报生成、报告聚合等。
- 引入数据血缘、状态机、可观测性（日志、指标、事件流）以及基本的错误处理和重试策略。
- 与 GitHub Actions 集成，保持持续集成/部署的无缝性，确保从 A 跳转到 B 的迁移可回滚。

## 架构轮廓
- Dagster/Prefect 作为编排层，核心任务节点对应现有组件的包装实现。
- 数据血缘：记录输入 URL、提取版本、摘要版本、分类结果、日报版本。
- 错误处理：局部重试、全局兜底、降级路径（如 RSS 描述）
- 可观测性：日志字段、事件、指标（提取成功率、摘要置信度、分类准确率等）

## 阶段性里程碑（初步）
- M1：搭建最小可运行的 Dagster/Prefect 流程并对接现有 Python 模块。
- M2：实现数据血缘、基本监控与错误处理。
- M3：通过 CI/CD 验证迁移的可回滚性。 

## 风险与回滚点
- 风险：学习曲线、社区生态差异导致实现成本上升。
- 回滚：在方案 A 上保留稳定分支，必要时进行阶段性回滚。

## 里程碑验收标准
- 能力：端到端流程在 Dagster/Prefect 下可执行，输出日志和日报。
- 可观测性：血缘、状态、错误信息可查询。
- 回滚点：能无痛返回到基线 A。

## 参考与下一步
- 参考 Dagster/Prefect 官方文档与示例。
- 下一步：创建最小可运行的 Dagster/Prefect 资产/流图，以及相应的测试用例。
