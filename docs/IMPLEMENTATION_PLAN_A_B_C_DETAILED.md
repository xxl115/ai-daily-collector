详细实施方案：方案 A/B/C 的阶段计划、里程碑、风险与回滚

1. 背景与目标
- 目标：在现有资源约束下，提供一个可落地、可验证、可扩展的端到端 AI 内容处理流水线实现方案集合，覆盖从快速落地到长期可扩展的场景。
- 三个方案的定位：
  - 方案 A：GitHub Actions 基线实现，快速落地、低运营成本、易维护。
  - 方案 B：Dagster/Prefect 编排，提升鲁棒性、可观测性和数据血缘能力，适合更高的扩展性需求。
  - 方案 C：微服务化端到端流水线，提供极致的模块化和横向扩展性，适合大规模并发与跨团队协作。
 
2. 共同设计原则
- 幂等性：所有核心操作必须幂等，确保重复执行不会产生重复数据或副作用。
- 容错与降级：提供至少两级以上的降级路径，确保核心产出在部分组件失败时仍可用。
- 数据血缘与可观测性：记录数据来源、处理版本、时间戳、状态及指标，方便调试与回溯。
- 性能与成本平衡：在资源有限的环境下通过缓存、分段处理和并发控制实现可控的性能。
- 测试覆盖：覆盖核心路径的单元、集成与端到端测试，包含降级与异常场景。
- 变更与回滚：明确的回滚策略与版本化变更。 

3. 方案 A（GitHub Actions 基线实现）详解
3.1 目标与范围
- 端到端流水线：抓取 → 提取 → 摘要 → 分类 → 日报输出，输出格式包括 JSON 结构和 Markdown 日报。
- 关键特性：幂等、降级、缓存、基本观测性、简单测试。

3.2 架构概览
- 输入：ai/articles/original 目录中的 Markdown 列表（含 URL 与标题）
- 处理链：Trafilatura 提取文本（主流方案） → Jina Reader 降级提取（备选） → Ollama/Qwen 生成摘要 → BAAI/bge-m3 分类（嵌入 + 相似度）
- 输出：ai/articles/processed/{title}.json、ai/daily/REPORT.md；可选推送到 Notion/其他平台。
- 资源约束：GitHub Actions 6 小时、2 核 CPU、7 GB RAM。

3.3 关键数据模型
- ArticleRecord: { url, title, content, summary, category, tags, source, processed_at, hash }
- SummaryRecord: { article_url, summary_text, model, timestamp }
- CategoryRecord: { article_url, category, scores, tags }

3.4 阶段性工作计划（阶段 I：A1-A5）
- A1: 架构骨架与 GH Actions 草案
  - 新增 .github/workflows/content-processing.yml，包含环境设置、依赖安装、Ollama 启动、核心处理、日报生成与提交。
  - 提供一个 content_processor.py 的骨架，包含 Extractor、Summarizer、Classifier、Reporter 的基本调用路径。
- A2: 幂等与去重实现
  - 为每篇文章生成全局唯一 ID（URL + 提取版本），记录已处理条目，避免重复生成日报。
- A3: 降级路径实现
  - 实现提取失败降级到 RSS 描述；摘要、分类失败降级为简短摘要/默认分类。
- A4: 缓存策略
  - 引入依赖缓存与中间结果缓存，避免重复下载与重复推理，确保可重复执行。
- A5: 基本监控与测试
  - 输出关键指标（提取成功率、摘要长度、分类置信度、日报输出状态），编写基础测试用例。

3.5 阶段性里程碑（A1-A5）
- Milestone 1：骨架就绪，能够在本地/轻量环境跑通 5 篇文章的端到端流程。
- Milestone 2：幂等、降级、缓存落地，端到端执行稳定。
- Milestone 3：端到端验证与简单测试通过。

3.6 方案 B（Dagster/Prefect 编排）详解
- 目标：提升鲁棒性、可观测性、数据血缘，支持跨步骤的错误复用与重试。
- 核心设计：把提取、摘要、分类、日报等阶段定义为“资产/任务”，实现数据血缘和任务状态追踪。
- 阶段计划：B1 数据编排模型设计、B2 核心资产实现、B3 观测性与告警、B4 CI/CD 集成与回滚。
- 风险与缓解：学习成本、维护成本、与现有代码耦合风险，逐步迁移。 

3.7 方案 C（微服务）详解
- 目标：模块化服务，服务之间通过轻量接口通信，支持大规模并发与跨团队协作。
- 架构要点：Extractor Servicio、Summarizer Service、Classifier Service、Reporter Service、Aggregator Service；缓存与降级策略分布在各服务。
- 阶段计划：C1 服务接口定义与雏形、C2 容器化/部署、C3 缓存、C4 端到端验证与成本评估。
- 风险与缓解：运维复杂度、成本上升，回滚回到方案 B。

4. 跨方案公共点（Observability, QA, Security）
- 指标体系：提取成功率、摘要准确度、分类置信度、日报完整性、执行时长、资源使用等。
- 测试策略：单元测试、集成测试、端到端测试、降级路径测试。
- 日志与追踪：统一日志格式、关键字段、可观察性仪表盘。
- 安全与合规：数据来源、缓存、外部请求的访问控制与日志隐私。

5. 实施时间表（建议版本节奏）
- 短期（2-4 周，阶段 I 的 A1-A5）
- 中期（4-8 周，阶段 II 的 B1-B4）
- 长期（2-3 个月，阶段 III 的 C1-C4）

6. 资源与成本估算
- GitHub Actions 的用量成本、模型缓存、依赖缓存、网络请求成本等。
- 微服务阶段需要额外的容器/云资源，成本上升需通过成本模型对比评估。

7. 变更记录
- 初始草案版本：2026-02-13
- 更新记录：逐步合并到主分支前，记录改动点与验证结果。

8. 参考资料与链接
- Dagster/Prefect 官方文档
- GitHub Actions 缓存文档
- Trafilatura、Ollama、qwen、BAAI/bge-m3 等模型/工具的官方文档
- 数据管线设计与幂等性/重试的行业最佳实践

9. 附录
- 术语表、缩略语、数据字段说明等。
